# VHDL硬件描述语言基础

[TOC]

## 1. VHDL语言相关知识

1. VHDL是VHSIC HDL（超高速集成电路硬件描述语言）的缩写。
2. FPGA电路设计的抽象层次：行为层次、寄存器传输层次（RTL）、逻辑门层次、布图层次。FPGA设计需要设计到RTL以上的层次实现，底层通过综合工具和实现工具完成。
	> 行为层次主要关注模块的功能描述和仿真验证，全部建模语句均可使用；
	> 寄存器传输层次主要关注模块的可综合电路的实现，只能用可综合的语句；
	> 逻辑门层次考虑如何用门级电路实现给定功能；
	> 布图层次考虑如何将电路适配到FPGA的资源中。

## 2. VHDL语言设计的基本的单元

1. VHDL是由设计单元组成的，基本设计单元包括：实体（Entity）、构造体（Architecture）、配置（Configuration）、包集合（Package）、库（Library）。
2. 实体：实体描述了模块的标识（实体名称）、模块的外部接口以及接口的相关参数。
	- 语句格式如下：
		```VHDL
		entity 实体名称 is
			generic( 参数名称: 参数类型 [:= 默认值];
					 参数名称: 参数类型 [:= 默认值];
					 ......
					 参数名称: 参数类型 [:= 默认值]);
			port( 端口名称{, 端口名称, ...}: 端口模式 数据类型;
				  端口名称{, 端口名称, ...}: 端口模式 数据类型;
				  ......
				  端口名称{, 端口名称, ...}: 端口模式 数据类型);
		end 实体名称;
		```
	- generic部分为参数声明，由三部分构成：参数名称、参数类型、参数默认值，其中参数的默认值是可选的。实体内部声明的参数可作为常数使用。generic必须放在port之前。实体在其他模块中被例化或者使用配置时，参数将被传递进来，如果在例化或配置时没有传递参数，则参数保持为默认值。
	- port部分为端口声明部分，由三部分构成：端口名称、端口模式、数据类型。
	- 端口模式用于定义模块端口的数据传输模式，VHDL的端口模式共有5种：in，out，inout，buffer，linkage。
		|模式|含义|
		|------|------|
		|in|输入，只能被读取，不能被赋值|
		|out|输出，只能被赋值，不能被读取|
		|inout|双向，可以被读取也可以被赋值，读取的是输入值，而不是所赋的值|
		|buffer|缓冲输出，类似于out，但值可以被读取，读取的是被赋的值;</br>当一个实体的端口用buffer模式时，只能与其他实体的buffer类型端口相连|
		|linkage|不指定方向，可以与任意类型端口相连|
	- 端口数据类型：支持标准逻辑类型，包括布尔型（boolean）、位型（bit）、位矢量型（bit_vector）、整数型（integer）。使用这些逻辑类型前，必须声明IEEE库（IEEE std_logic_1164）。
		```VHDL
		// 声明库
		library IEEE;
		use IEEE.STD_LOGIC_1164.all;

		// 数据类型的表达方式：数据类型标识(高位 downto 低位)
		// 数据类型标识  位型——STD_LOGIC
		//			   位矢量——STD_LOGIC_VECTOR
		```
3. 构造体：构造体描述了模块的内部功能、行为或结构实现。构造体是一个从属单元，须与实体声明联合使用，一个实体声明可对应多个构造体。
	- 语句格式如下：
		```VHDL
		architecture 构造体名称 of 实体名称 is
			{声明语句;}
		begin
			{并发语句;}
		end 构造体名称;
		```
	- 构造体在描述模块内部实现时通常有三种方式：行为描述、数据流描述、结构描述。
		|描述方式|特点|
		|------|------|
		|行为描述|抽象层最高的描述，描述使用电路的行为特性，通常用process方式进行描述|
		|数据流描述|使用标准布尔函数，将信号间的布尔代数关系用布尔方程式来表示|
		|结构描述|主要通过下层模块的声明和调用及端口映射将下层模块相连，构成结构性描述|
	- 声明语句：位于begin之前，可用于声明下列描述语句：
		- “use”语句；
		- 子程序声明；
		- 子程序体；
		- 类型声明；
		- 子类型声明；
		- 常量声明；
		- 信号声明；
		- 元件声明；
		- 并发语句。
	- 并发语句：每个并发语句都定义了一个运算单元，该单元包括三部分：读取信号值、对读取的信号值进行运算、将运算结果赋给另一个信号。
		- 特点：构造体中所有并发语句都是同时进行运算的。
		- 并发语句类型：块语句、元件例化、过程调用、进程、信号赋值。
4. 配置：配置用于描述设计的层次之间的互联关系，以及实体与结构休之间的连接关系。
	- 一个实体声明可以对应多个构造体，但这个实体被上层模块调用并最终形成电路时，只能使用一种结构体作为实体功能实现的描述。用配置结构将实体与对应的结构体连接起来。配置不是VHDL代码必备的部分，它不是从属单元，可以独立存在。通常在使用时都会将配置单独写入一个文件。
	- 语句格式如下：
		```VHDL
		configuration 配置名称 of 实体名称 is
			配置语句;
		end 配置名称;

		// 一个实体的配置可以在这个实体被上层模块调用时，作为上层模块中的配置语句使用
		```
	- 配置语句结构
		```VHDL
		for 结构体名称
			use
			配置项;
		end for
		```
5. 包集合：包集合用于存储在工程设计中需要反复用到的常量定义、数据类型定义、子类型定义、子程序和函数声明等。
	- 语句格式如下：
		```VHDL
		// 包集合由包集合声明和包集合体两部分构成
		// 包集合声明
		package 包集合名称 is
			包集合声明语句
		end 包集合名称;

		// 包集合体
		package body 包集合名称 is
			包集合体描述语句
		end 包集合名称

		// 包集合调用
		use 库名称.包集合名称;
		```
	- 包集合声明语句中声明的这些定义对外界是可见的。包集合中声明的信号在不同的实体中是不能共享的，如果多个实体都使用了集合中的同一个信号，则每个实体内都会有一个独立的该信号的复制信号。
6. 库：库中包含了编译后数据的集合，这些数据包括实体定义、构造体定义、配置定义和包集合定义。所有的VHDL设计元素经过编译后最终都会包含在库中。
	- 语句格式如下：
		```VHDL
		library 库名称;
		```
	- 库分类：IEEE库、STD库、ASIC库、WORK库、用户自定义库。
		|库|内容|
		|------|------|
		|IEEE库|包含了“STD_LOGIC_1164”、“STD_LOGIC_ARITH”和“STD_LOGIC_UNSIGNED”等包集合，这些包集合定义了一些工程设计中常用的数据类型等定义|
		|STD库|VHDL的标准库，库中有标准的“STANDARD”包集合|
		|ASIC库|各公司为了使用VHDL语言进行门级仿真而提供的ASIC逻辑门库|
		|WORK库|类似于项目管理文件夹，项目中设计的所有单元都存放于这个库中|
		|用户自定义库|用户自行开发的库，用于包含多个实体中共用的包集合和实体等|
	- VHDL中库与库之间是相互独立的，不能互相嵌套。其中WORK库和STD库是工程设计中每个设计单元都要用到的库，设计过程中可以不用标准格式说明。

## 3. VHDL语言的对象和数据类型

1. 对象类型
	- 对象（Object）：可以赋值的都称为对象。
	- 类型：端口（Port）、常量（Constant）、信号（Signal）、变量（Variable）。
	- 对象的定义格式：
		```VHDL
		对象类型 对象名称: [端口模式] 数据类型(高位 downto 低位)[:= 初值];
		// port的定义需要添加端口模式，另外需要在外面加上括号
		```
	- 端口（Port）：定义了实体信号传递接口。
		- 端口模式如下：
			|端口模式|含义|
			|------|------|
			|in|输入，只能被读取，不能被赋值|
			|out|输出，只能被赋值，不能被读取|
			|inout|双向，可以被读取也可以被赋值，读取的是输入值，而不是所赋的值|
			|buffer|缓冲输出，类似于out，但值可以被读取，读取的是被赋的值;</br>当一个实体的端口用buffer模式时，只能与其他实体的buffer类型端口相连|
			|linkage|不指定方向，可以与任意类型端口相连|
		- 其中in、inout、buffer端口可以对其他对象赋值，out、inout、buffer可以被其他对象赋值。
	- 常量（Constant）：常量是一个固定值，在使用过程中只能对其他对象赋值，不能被修改。
		- 常且可以在结构体、包集合、实体、块语句、过程语句和子函数中声明，在结构体中声明的常量是本地常星，只能在结构体内部使用。
		- 声明格式：
			```VHDL
			constant 常量名称: 数据类型:= 常量表达式
			```
2. 数据类型